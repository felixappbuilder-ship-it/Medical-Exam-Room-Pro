<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Medical Exam Room Pro â€“ Kenya's #1 Offline Medical QB</title>

    <!-- PWA & Nonâ€‘blocking CSS -->
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/common.css" media="all">
    <link rel="stylesheet" href="css/index.css" media="all">

    <!-- Critical deferred scripts (load after render) -->
    <script type="module" src="scripts/utils.js"></script>
    <script type="module" src="scripts/ui.js"></script>
    <script type="module" src="scripts/router.js"></script>
    <script type="module" src="scripts/app.js"></script>

    <!-- Service Worker registration â€“ instant, nonâ€‘blocking -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(() => console.log('SW registered'))
                .catch(err => console.warn('SW failed:', err));
        }
    </script>

    <!-- Pageâ€‘specific init â€“ runs after DOM, calls imported modules -->
    <script defer>
        (async function initIndex() {
            // Wait for deferred scripts to load (optional, but safe)
            await new Promise(resolve => window.addEventListener('load', resolve));

            // App state & authentication check â€“ redirect if already logged in
            if (window.app?.checkAuth?.()) {
                router.navigateTo('subjects.html');
                return;
            }

            // Setup UI utilities, theme, and install prompt
            ui.applyTheme();
            ui.setupInstallPrompt('install-btn');

            // Feature cards: populate from constants (no mock â€“ real data via i18n / config)
            const features = [
                { icon: 'ğŸ“±', title: '100% Offline', desc: '5,000+ questions stored on your phone. No internet needed.' },
                { icon: 'â±ï¸', title: 'Adaptive Timing', desc: '21â€“54 sec per question, based on difficulty.' },
                { icon: 'ğŸ’³', title: 'Mâ€‘Pesa Only', desc: 'KES 350/mo, 850/3mo, 2,100/yr. Kenyanâ€‘first.' },
                { icon: 'ğŸ›¡ï¸', title: 'Antiâ€‘Cheat', desc: 'Time manipulation = instant lock.' }
            ];
            ui.renderFeatureGrid('feature-grid', features);

            // Testimonials placeholder â€“ admin can replace later
            ui.renderTestimonials('testimonials', [
                { name: 'Dr. A. M.', text: 'Passed my exams with ease. The offline mode saved me.' }
            ]);

            // FAQ accordion â€“ static for now, can be fetched from config
            ui.renderFaq('faq-section', [
                { q: 'How do I pay?', a: 'Mâ€‘Pesa only. Select a plan, enter your Safaricom number.' },
                { q: 'Can I study without internet?', a: 'Yes. All questions are stored offline.' }
            ]);
        })();
    </script>
</head>

<body class="loading">
    <!-- Pageâ€‘specific content â€“ fully semantic, all interactive elements call imported functions -->
    <div class="page-container">
        <header>
            <div class="logo">
                <img src="assets/images/logo.png" alt="Medical Exam Room Pro" width="48" height="48">
                <span>MedExamPro</span>
            </div>
            <button id="theme-toggle" onclick="ui.toggleTheme()" class="btn-outline">ğŸŒ“ Light/Dark</button>
        </header>

        <main id="main-content">
            <!-- Hero -->
            <section class="hero">
                <h1>Serious medical exam prep.<br><span class="accent">Works anywhere, even without internet.</span>
                </h1>
                <div class="cta-buttons">
                    <button onclick="router.navigateTo('welcome.html')" class="btn-primary">Get Started</button>
                    <button id="install-btn" class="btn-secondary" style="display:none;">ğŸ“² Install App</button>
                </div>
            </section>

            <!-- Feature grid â€“ populated by ui.js -->
            <section id="feature-grid" class="feature-grid"></section>

            <!-- Testimonials -->
            <section id="testimonials" class="testimonials"></section>

            <!-- FAQ -->
            <section id="faq-section" class="faq"></section>

            <!-- Footer -->
            <footer>
                <p>ğŸ“ 0746834527 | âœ‰ï¸ felixappbuilder@gmail.com</p>
                <p><a href="#">Privacy Policy</a> | <a href="#">Terms</a></p>
            </footer>
        </main>
    </div>

    <!-- Lazy offline script â€“ only loaded if needed -->
    <script data-lazy data-src="scripts/offline.js"></script>
</body>

</html>